<!DOCTYPE html>
<html
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}"
    lang="en"
>
<head>
    <title>Home â—† WeightTracker</title>

    <link type="text/css" rel="stylesheet" th:href="@{public/css/pages/home.css}"  />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <main layout:fragment="content">
        <section class="container">
            <h1>Homescreen</h1>

            <button onclick="location.href='/'" id="toHome" type="button">
                Home
            </button>

            <button onclick="location.href='/addweight'" id="toAddweight" type="button">
                addWeight
            </button>

            <button onclick="location.href='/about'" id="toAbout"type="button">
                About</button>

            <button onclick="location.href='/' + user.id + '/edit'" id="toEdit" type="button">
                Edit Account
            </button>

            <div>
                <canvas id="myChart"></canvas>
            </div>
        </section>
    </main>

    <script layout:fragment="script" th:inline="javascript">
        /*<![CDATA[*/
        let weightEntries = /*[[${weightEntries}]]*/ [];
        let user = /*[[${user}]]*/ {};
        /*]]>*/

        const labels = weightEntries.map(weightEntry => {
            const date = new Date(weightEntry.date);
            return date.toDateString();
        });

        const values = weightEntries.map(weightEntry => {
            return weightEntry.weight
        });

        const data = {
            labels: labels,
            datasets: [{
                label: 'My Weight Journey',
                backgroundColor: 'rgb(255, 99, 132)',
                borderColor: 'rgb(255, 99, 132)',
                data: values,
            }]
        };

        const config = {
            type: 'line',
            data: data,
            options: {
                onClick: (e) => {
                    const canvasPosition = Chart.helpers.getRelativePosition(e, myChart);

                    // Substitute the appropriate scale IDs
                    const dataX = myChart.scales.x.getValueForPixel(canvasPosition.x);
                    const dataY = myChart.scales.y.getValueForPixel(canvasPosition.y);

                    const weightEntry = weightEntries[dataX];

                    location.href = `/weights/${weightEntry.id}/edit`;
                },
            }
        };

        const myChart = new Chart(
            document.getElementById('myChart'),
            config
        );
    </script>
</body>
</html>